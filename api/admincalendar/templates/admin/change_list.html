{% extends "admin/change_list.html" %}
{% load i18n admin_urls static admin_list %}

{% block content %}
  {% if cl.model_admin.admin_calendar %}
      <div id='calendar-admin'></div>

      <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.9.0/main.min.css" rel="stylesheet" />
      <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.9.0/main.min.js"></script>

      <script type="text/javascript">
      var BASE_URL = window.location.pathname;
      var ADMIN_CALENDAR_ADD_FIELD = "{{ cl.model_admin.admin_calendar_add_field }}";

      document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar-admin');

        var calendar = new FullCalendar.Calendar(calendarEl, {
          selectable: true,
          initialView: 'dayGridMonth',
          initialDate: new Date(),
          headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
          },
          eventSources: [{
            url: BASE_URL
          }],
          dateClick: function(dateInfo) {
            console.log(dateInfo);
            if (ADMIN_CALENDAR_ADD_FIELD) {

              var url = [
                location.pathname,
                "add/?",
                ADMIN_CALENDAR_ADD_FIELD,
                "=",
                dateInfo.dateStr,
              ].join('')

              location.href = url;
            }
          },
          eventClick: function(info) {
            info.jsEvent.preventDefault(); // don't let the browser navigate

            if (info.event.url) {
              window.open(info.event.url);
            }
          }
        });

        calendar.render();
      });

      </script>
  {% else %}
    {{ block.super }}
  {% endif %}
{% endblock %}
